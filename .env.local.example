# ==============================================================================
#                   AGENT OS LOCAL ENVIRONMENT CONFIGURATION
# ==============================================================================
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to `.env.local` in the project root
# 2. Fill in all required values (marked as 'your-...' or 'sk-...')
# 3. Generate secure random values for secrets using: openssl rand -base64 32
# 4. Run `make start-dev` to start all local services
#
# ==============================================================================


# ==============================================================================
#                          BASE CONFIGURATION
# ==============================================================================
#
# These define the base URLs for all services running locally.
# Ports are already configured in docker-compose.local.dev.yml so no need to change this unless you want to override the settings
#
PLATFORM_DOMAIN=localhost
PLATFORM_PROTOCOL=http

# Derived base URLs - only override if you have custom port configurations
FRONTEND_BASE_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:3000
# SUPABASE_PUBLIC_URL - Public-facing URL for Supabase (IMPORTANT: Must be HTTPS in production)
# Used by: Browser clients, LangConnect storage service (for signed URLs), external LLMs
# Local dev: http://localhost:8000
# Production: https://supabase.yourdomain.com (must be HTTPS for Claude API)
SUPABASE_PUBLIC_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:8000
LANGCONNECT_BASE_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:8080
MCP_PUBLIC_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:8002
N8N_PUBLIC_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:5678
WINDMILL_PUBLIC_URL=${PLATFORM_PROTOCOL}://${PLATFORM_DOMAIN}:9000

# LangGraph runs locally via `langgraph dev` on port 2024
# The host.docker.internal address allows Docker containers to reach your host machine - no need to change this unless you override any settings
LANGGRAPH_EXTERNAL_URL=http://host.docker.internal:2024


# ==============================================================================
#                       LANGGRAPH / LANGSMITH CONFIGURATION
# ==============================================================================
#
# LangGraph handles AI agent orchestration and execution and langsmith is used for tracing
# Local development runs via `langgraph dev` (started automatically by make start-dev)

# -- LangSmith Tracing (Required) --
# LangSmith provides debugging, monitoring, and tracing for agent runs
# Get API key from: https://smith.langchain.com
# Generous free tier for local development
LANGSMITH_TRACING=true                              # Enable tracing (recommended)
LANGSMITH_ENDPOINT=https://eu.api.smith.langchain.com  # Or us.api.smith.langchain.com
LANGSMITH_PROJECT=agent-os-dev                      # Project name in LangSmith for tracing
LANGSMITH_API_KEY=ls__your-api-key                  # Your LangSmith API key

# -- MCP Server URL for Tool Calls --
# LangGraph agents call the MCP server to execute tools
# Must be accessible from LangGraph (use localhost for local dev)
LANGGRAPH_MCP_SERVER_URL=${MCP_PUBLIC_URL}

# ==============================================================================
#                         SUPABASE CONFIGURATION
# ==============================================================================

# -- PostgreSQL Database Password --
# Used by all Supabase services to connect to the database
# Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password
#
# -- Supabase JWT Secret and API Keys --
# Supabase provides authentication, database, and storage services.
# Generate JWT secrets and keys at: https://supabase.com/docs/guides/self-hosting/docker
# JWT_SECRET: Used to sign authentication tokens (min 32 characters)
# SUPABASE_ANON_KEY: Public key for client-side API calls (read/write with RLS)
# SUPABASE_SERVICE_KEY: Admin key for server-side operations (bypasses RLS)
# Generate all three using the Supabase self-hosting guide via link above
JWT_SECRET=your-super-secret-jwt-secret-with-at-least-32-characters-long
SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_KEY=your-supabase-service-key

# -- Supabase Auth Configuration --
# Control user registration and authentication features
# Recommend using these defaults unless absolutely necessary
DISABLE_SIGNUP=true                    # Prevent public sign-ups (admins create users)
ENABLE_EMAIL_SIGNUP=true               # Allow email/password authentication
ENABLE_EMAIL_AUTOCONFIRM=false         # Require email verification (set true to skip)
ENABLE_ANONYMOUS_USERS=false           # Allow anonymous sessions
ENABLE_PHONE_SIGNUP=false              # Allow SMS-based authentication

# -- SMTP Configuration for Transactional Emails --
# Used for: password resets, email verification, magic links, invitations
# Not stricly necessary as you can manage this from the supabase admin portal but definitely useful.
# Gmail setup: Visit: https://myaccount.google.com/security, and select 2-Step Verification
# Enable 2FA (if not already)
# Then go to App Passwords â†’ Generate password and fill in the below with you smtp pass
SMTP_HOST=smtp.gmail.com                      # Gmail SMTP server
SMTP_PORT=587                                 # Standard SMTP port
SMTP_USER=your-email@gmail.com                # Your Gmail address
SMTP_PASS=your-gmail-app-password             # Gmail app password (not account password)
SMTP_ADMIN_EMAIL=admin@your-domain.com        # "From" address for system emails
SMTP_SENDER_NAME="Agent Platform"             # Display name for system emails

# -- Supabase Connection Pooling Secrets --
# Required by Supavisor (connection pooler) for encryption and JWT signing
# Generate with: openssl rand -base64 64 | tr -d '\n'
SECRET_KEY_BASE=your-base64-secret-key
# IMPORTANT: Must be exactly 32 alphanumeric characters (NOT base64 encoded)
# Generate with: openssl rand -base64 48 | tr -dc 'A-Za-z0-9' | head -c32; echo
VAULT_ENC_KEY=your32characteralphanumerickey12

# -- Supabase Studio Dashboard Credentials --
# Login credentials for Supabase Studio at http://localhost:8000
# Change from defaults for production!
DASHBOARD_USERNAME=admin
DASHBOARD_PASSWORD=password


# ==============================================================================
#                     LANGCONNECT API CONFIGURATION
# ==============================================================================
#
# LangConnect is the FastAPI backend that handles:
# - Document ingestion and processing (RAG)
# - Vector embeddings and search
# - Agent/assistant metadata storage
# - Knowledge base management
#

# -- Service Account Authentication --
# Internal admin key for service-to-service communication
# Used when backend services need to call LangConnect without user context
# Generate with: openssl rand -base64 32
LANGCONNECT_SERVICE_ACCOUNT_KEY=your-super-secret-internal-admin-key

# -- AI Thread Naming Configuration --
# Automatic thread naming and summarization using GPT-4o-mini
# Threads are automatically named at message intervals (1, 5, 10, 15, 20...)
# User-renamed threads are protected from AI overwrites
THREAD_NAMING_ENABLED=true                      # Enable AI thread naming (default: true)
THREAD_NAMING_MODEL=gpt-4o-mini                 # Model for naming (cost-effective option)
THREAD_NAMING_INTERVAL_SECONDS=30               # How often to check for threads needing naming
THREAD_NAMING_BATCH_SIZE=5                      # Max threads to process per batch
THREAD_NAMING_MIN_INTERVAL_SECONDS=60           # Min seconds between naming attempts per thread


# ==============================================================================
#                        MCP SERVER CONFIGURATION
# ==============================================================================
#
# The MCP (Model Context Protocol) server provides:
# - Secure tool gateway for AI agents
# - OAuth-based authentication for third-party clients
# - Integration with external services (Arcade, custom tools)
#

# -- MCP Authentication Secrets --
# MCP_TOKEN_SIGNING_SECRET: Signs short-lived access tokens for tool execution
# MCP_SERVICE_ACCOUNT_KEY: Static key for automated service-to-service calls
# Both should be long random strings. Generate with: openssl rand -base64 32
MCP_TOKEN_SIGNING_SECRET=your-super-secret-mcp-token-signing-secret
MCP_SERVICE_ACCOUNT_KEY=your-super-secret-service-account-key

# -- Arcade Integration (Optional) --
# Arcade provides OAuth-based tool access to external services with 1000s of pre-built integrations
# Arcade offer a free tier that will be sufficient for local development but is a paid service as usage grows
# Get API key from: https://docs.arcade.dev
ENABLE_ARCADE=false                                    # Enable Arcade tools - recommend setting to true and providing an API key
ENABLED_ARCADE_SERVICES=microsoft,gmail,google,slack  # Comma-separated list of services. Set to 'all' to register all arcade tools
ARCADE_API_KEY=                                       # Your Arcade API key


# ==============================================================================
#                      WEB FRONTEND CONFIGURATION
# ==============================================================================
#
# Next.js application that provides the user interface.
# Variables with NEXT_PUBLIC_ prefix are exposed to the browser.
#

# -- Supabase Client Configuration --
# Used by browser and server for authentication and API calls
NEXT_PUBLIC_SUPABASE_URL=${SUPABASE_PUBLIC_URL}
NEXT_PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}

# -- Service URLs --
# Frontend needs to know where to reach backend services (given the frontend is outside the docker network in local dev, the langgraph API must be set to localhost and not host.docker.internal)
NEXT_PUBLIC_LANGCONNECT_API_URL=${LANGCONNECT_BASE_URL}
NEXT_PUBLIC_MCP_SERVER_URL=${MCP_PUBLIC_URL}
NEXT_PUBLIC_LANGGRAPH_API_URL=http://localhost:2024
NEXT_PUBLIC_N8N_URL=${N8N_PUBLIC_URL}
NEXT_PUBLIC_WINDMILL_URL=${WINDMILL_PUBLIC_URL}
NEXT_PUBLIC_BASE_API_URL=${FRONTEND_BASE_URL}/api

# -- LangGraph Deployment Configuration --
# For local dev, these are placeholder UUIDs that work with `langgraph dev`
# In production, get these values from your LangGraph Cloud deployment
NEXT_PUBLIC_LANGGRAPH_DEPLOYMENT_ID=cfceb904-6917-4485-a965-f1d7e472c269  # Any valid UUID v4
NEXT_PUBLIC_LANGGRAPH_TENANT_ID=ee2402c9-8454-4af6-9504-8a881ac22744      # Any valid UUID v4
NEXT_PUBLIC_LANGGRAPH_DEFAULT_GRAPH_ID=tools_agent                        # Default agent to use

# -- Feature Flags --
NEXT_PUBLIC_GOOGLE_AUTH_DISABLED=true               # Disable Google OAuth (not configured locally)
NEXT_PUBLIC_FRONTEND_BASE_URL=${FRONTEND_BASE_URL}  # Used for OAuth callbacks


# ==============================================================================
#                      WORKFLOW AUTOMATION SERVICES
# ==============================================================================
#
# n8n and Windmill provide workflow automation and no-code/low-code capabilities
#

# -- n8n Configuration --
# n8n stores workflows and credentials in the shared PostgreSQL database
# Encryption keys must remain constant or you'll lose access to encrypted data
# Generate with: openssl rand -base64 32
N8N_ENCRYPTION_KEY=your-super-secret-n8n-encryption-key
N8N_USER_MANAGEMENT_JWT_SECRET=your-super-secret-n8n-jwt-secret

# -- Windmill Configuration --
# Windmill uses a dedicated PostgreSQL database (separate from Supabase)
# These credentials are used to create and access the Windmill database
SERVICE_USER_POSTGRES=windmill
SERVICE_PASSWORD_POSTGRES=your-super-secret-windmill-db-password


# ==============================================================================
#                       EXTERNAL API KEYS
# ==============================================================================
#
# API keys for third-party services used by AI agents and tools
# All are optional but enable specific capabilities when provided
#

# -- AI Model Providers --
OPENAI_API_KEY=sk-your-openai-api-key          # For GPT models (gpt-4.1, gpt-5, etc.)
ANTHROPIC_API_KEY=your-anthropic-api-key       # For Claude models (claude-sonnet-4-5, claude-opus-4-1, claude-haiku-4-5)

# -- Tool APIs --
TAVILY_API_KEY=your-tavily-api-key             # Web search capabilities - https://www.tavily.com/ (get an API key here)
E2B_API_KEY=your-e2b-api-key                   # Code sandbox execution environment - https://e2b.dev/ (get an API key here)
E2B_TEMPLATE_ID=c46w5971k3l3r3qd4n9q           # Custom E2B template with document processing libs (optional, falls back to default)
FIREFLIES_API_KEY=your-fireflies-api-key       # Meeting transcripts and summaries - https://fireflies.ai/ (E18 specific)

# -- Microsoft Graph API for Outlook Integration (E18 specific) --
# Used for E18 Outlook custom toolkit to access user emails and calendars via Microsoft Graph API
# Setup instructions: https://learn.microsoft.com/en-us/graph/auth-register-app-v2
# 1. Register app in Azure AD (https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps)
# 2. Grant application permissions:
#    - Mail.Read, Mail.ReadWrite, Mail.Send (for email tools)
#    - Calendars.Read, Calendars.ReadWrite (for calendar tools)
# 3. Create client secret under "Certificates & secrets"
# 4. Admin consent required for application permissions
MICROSOFT_GRAPH_TENANT_ID=your-tenant-id-here           # Azure AD tenant ID (Directory ID)
MICROSOFT_GRAPH_CLIENT_ID=your-app-registration-id      # Application (client) ID from app registration
MICROSOFT_GRAPH_CLIENT_SECRET=your-client-secret        # Client secret value (not the secret ID)

# -- Document Ingestion --
SUPADATA_API_TOKEN=your-supadata-token         # YouTube transcript extraction - https://supadata.ai/ (get an API key here)


# ==============================================================================
#                      NHS ANALYTICS CONFIGURATION
# ==============================================================================
#
# NHS Analytics toolkit automatically uses the existing Postgres credentials above.
# Database connection is constructed from these environment variables:
# - POSTGRES_HOST (defaults to 'db' for local dev, set to 'db_prod' in production)
# - POSTGRES_PASSWORD, POSTGRES_USER, POSTGRES_DB, POSTGRES_PORT
#
# Connection patterns by environment:
# - Local dev MCP server: uses 'db:5432' (Docker internal network, default)
# - Production MCP server: uses 'db_prod:5432' (set via POSTGRES_HOST=db_prod)
# - E2B sandboxes: use 'host.docker.internal:5432' (external access, auto-detected)
#
# Optional: Set NHS_DATABASE_URL to override automatic construction
# NHS_DATABASE_URL=postgresql://postgres:password@custom-host:5432/postgres


# ==============================================================================
#                      IMAGE STORAGE CONFIGURATION
# ==============================================================================
#
# Controls whether the MCP server stores generated images in cloud storage (GCP)
# For local development, typically disabled unless testing GCP integration
#

# -- Image Storage Settings --
IMAGE_STORAGE_ENABLED=false                    # Enable/disable cloud image storage
IMAGE_PUBLIC_ACCESS=false                      # Enable public access URLs (no expiry, no signatures)

# -- GCP Storage Configuration (optional, only needed if IMAGE_STORAGE_ENABLED=true) --
# GCP_PROJECT_ID=your-gcp-project-id
# GCP_STORAGE_BUCKET=your-bucket-name
# GCP_CREDENTIALS_JSON=your-gcp-service-account-json


# ==============================================================================
#                        MONITORING & OBSERVABILITY
# ==============================================================================
#
# Sentry provides error tracking and performance monitoring (optional)
# Get DSN from: https://sentry.io
#

SENTRY_DSN_LANGCONNECT=                        # Sentry DSN for LangConnect service
SENTRY_DSN_MCP=                                # Sentry DSN for MCP server
SENTRY_DSN_WEB=                                # Sentry DSN for web frontend
SENTRY_DSN_LANGGRAPH=                          # Sentry DSN for LangGraph agents
SENTRY_ENVIRONMENT=development                 # Environment tag for Sentry events
SENTRY_TRACES_SAMPLE_RATE=1.0                  # 100% trace sampling (reduce in production)
SENTRY_PROFILES_SAMPLE_RATE=0.0                # 0% profiling (enable only when debugging)